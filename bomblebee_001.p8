pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- bomblebee
-- by aiken, basile, nathan

function _init()
 ps={}
 for i=1,2 do
  ps[i]=init_player(i-1,16*i,0)
 end
end

function _update60()
 foreach(ps,update_player)
end

function _draw()
 cls()
 map(0, 0, 0, 0)
 foreach(ps,draw_player)
end
-->8
function init_player(i, x, y)
 local p={}
 p.i=i
 p.x=x
 p.y=y
 p.dir=2
 p.moving=false
 p.btns={false, false, false, false}
 p.tick=0

 return p
end

function is_colliding(x,y)
 for dx in all({0,7}) do
  for dy in all({0,7}) do
   local mapval = mget(shr(x+dx,3), shr(y+dy,3))
   if (fget(mapval, 0)) return true
  end
 end
 return false
end

function update_player(p)

 p.tick+=1

 btn_diff = {false, false, false, false}
 for i=0,3 do
  btn_diff = not p.btns[i] and btn(i,p.i)
 end

 if p.moving then
  -- negative edge
  if p.btns[p.dir] and not btn(p.dir,p.i) then
   p.moving=false
  end

  -- positive edge
  for i=0,3 do
   if not p.btns[i] and btn(i,p.i) then
    p.dir=i
   end
  end
 end

 if not(p.moving) then
  for i=0,3 do
   if btn(i,p.i) then
    p.dir=i
    p.moving=true
   end
  end
 end

 newx = p.x
 newy = p.y

 if p.moving then
  if (p.dir == ⬅️) then
   newx -= 1
  elseif (p.dir == ➡️) then
   newx += 1
  elseif (p.dir == ⬆️) then
   newy -= 1
  elseif (p.dir == ⬇️) then
   newy += 1
  end
 end

 if not is_colliding(newx,newy+8) then
  p.x = newx
  p.y = newy
 end

 -- record which buttons were
 -- pressed
 for i=0,3 do
  p.btns[i] = btn(i,p.i)
 end
end

function draw_player(p)
 local s=max(1,p.dir)
 local o=16
 if (p.moving) o*=1+flr(p.tick/5)%3

 spr(s+p.i*3, p.x, p.y, 1, 1, p.dir==0)
 spr(s+o, p.x, p.y+8, 1, 1, p.dir==0)
end
__gfx__
0000000000000000000990000009900000000000000bb000000bb000556555655555555555555555555555550011110000000000000000000000000000000000
000000000999990000999900009999000bbbbb0000bbbb0000bbbb00555655565666666556666665544444451100001100000000000000000000000000000000
00700700999999000999999009999990bbbbbb000bbbbbb00bbbbbb0565556555655556556666665545444451000000100000000000000000000000000000000
00077000599d99900999999009d99d905bbdbbb00bbbbbb00bdbbdb0655565555655556556666665544445451111111100000000000000000000000000000000
000770005999ddd00599995009dddd905bbbddd005bbbb500bddddb0556555655655556556666665544444451000000100000000000000000000000000000000
0070070055999990195995910999999055bbbbb0ab5bb5ba0bbbbbb0555655565655556556666665544544451000000100000000000000000000000000000000
000000000d99550090955909959999d90dbb5500b0b55b0bb5bbbbdb565556555666666556666665544444451000000100000000000000000000000000000000
0000000000d9999195dddd691905509100dbbbbab5dddd6bab0550ba655565555555555555555555555555550111111000000000000000000000000000000000
00000000000dd000000dd000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000550dd000055dd550005dd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000151dd000011dd550005dd100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001615d000015d6110011dd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005555115055551111015dd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000056566561111155555556d111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000165665655555111155100551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055115100110055011100555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000dd000000dd000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000110dd000011dd550001dd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000155dd000015dd110005dd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005651d000055d6550055dd110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001551511011115555011dd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000016566565555511111156d555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000565665611111555555500111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011551500550055055100551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000dd000000dd000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000510dd000011dd110001dd100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000511dd000055dd550001dd500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001655d000011d6550015dd550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001551151055551111055dd110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000056566561111155555516d551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000165665655555555511100555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000015115100550011055500111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a0000000000000707070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000a0000000a0000000707080700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000a00000708070800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a0000000000000709080700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000807090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
